<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <title>Horror Night - Maison</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    body { margin:0; overflow:hidden; background:#000; color:#fff; font-family:sans-serif; }
    #overlay {
      position: absolute; top:0; left:0; right:0; bottom:0;
      background: rgba(0,0,0,0.8);
      display:flex; align-items:center; justify-content:center;
      flex-direction:column; z-index:10;
    }
    #overlay button {
      padding: 10px 20px; font-size:1.2rem; background:darkred; color:white; border:none;
      border-radius:4px; cursor:pointer;
    }
    canvas { display:block; width:100vw; height:100vh; }
  </style>
</head>
<body>
  <div id="overlay">
    <h1>Petite Maison Abandonnée</h1>
    <button id="start">Jouer</button>
  </div>
  <canvas id="canvas"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

  <script>
  const overlay = document.getElementById('overlay');
  const btn = document.getElementById('start');

  let scene, camera, renderer, controls;
  let move = {forward:false, back:false, left:false, right:false};
  const vel = new THREE.Vector3(), dir = new THREE.Vector3();
  let prevTime = performance.now();

  btn.onclick = () => {
    overlay.style.display = 'none';
    init();
    animate();
  };

  function init(){
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x000000);

    camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0,1.6,5);

    renderer = new THREE.WebGLRenderer({canvas:document.getElementById('canvas'), antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;

    const ambient = new THREE.AmbientLight(0x404040,1.5);
    const dirLight = new THREE.DirectionalLight(0xffffff,1);
    dirLight.position.set(5,10,7);
    scene.add(ambient, dirLight);

    // sol
    const floor = new THREE.Mesh(new THREE.PlaneGeometry(50,50),
      new THREE.MeshStandardMaterial({color:0x222222}));
    floor.rotation.x = -Math.PI/2;
    scene.add(floor);

    // petite maison
    const house = new THREE.Group();
    const wallMat = new THREE.MeshStandardMaterial({color:0x444444});
    const roofMat = new THREE.MeshStandardMaterial({color:0x333333});
    // murs
    const boxGeo = new THREE.BoxGeometry(4,3,4);
    const box = new THREE.Mesh(boxGeo, wallMat);
    box.position.y = 1.5;
    house.add(box);
    // toit
    const roofGeo = new THREE.ConeGeometry(3.5,1.5,4);
    const roof = new THREE.Mesh(roofGeo, roofMat);
    roof.position.y = 3.75;
    roof.rotation.y = Math.PI/4;
    house.add(roof);
    scene.add(house);

    // contrôles clavier
    document.addEventListener('keydown',e=>{
      if(e.code==='KeyW') move.forward=true;
      if(e.code==='KeyS') move.back=true;
      if(e.code==='KeyA') move.left=true;
      if(e.code==='KeyD') move.right=true;
    });
    document.addEventListener('keyup',e=>{
      if(e.code==='KeyW') move.forward=false;
      if(e.code==='KeyS') move.back=false;
      if(e.code==='KeyA') move.left=false;
      if(e.code==='KeyD') move.right=false;
    });

    // click pour activer pointeur
    document.body.addEventListener('click', () => {
      document.body.requestPointerLock();
    });
    document.addEventListener('pointerlockchange', () => {
      document.body.requestPointerLockElement === document.body;
    });
    document.addEventListener('mousemove',e=>{
      if(document.pointerLockElement){
        camera.rotation.y -= e.movementX * 0.002;
        camera.rotation.x -= e.movementY * 0.002;
        camera.rotation.x = Math.max(-Math.PI/2, Math.min(Math.PI/2, camera.rotation.x));
      }
    });

    window.addEventListener('resize',()=>{
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  }

  function animate(){
    requestAnimationFrame(animate);
    const time = performance.now();
    const delta = (time - prevTime) / 1000;
    vel.x -= vel.x * 10.0 * delta;
    vel.z -= vel.z * 10.0 * delta;
    dir.z = Number(move.forward) - Number(move.back);
    dir.x = Number(move.right) - Number(move.left);
    dir.normalize();
    const speed = 4;
    if(move.forward||move.back) vel.z -= dir.z * speed * delta;
    if(move.left||move.right) vel.x -= dir.x * speed * delta;
    camera.position.x += vel.x * delta;
    camera.position.z += vel.z * delta;
    prevTime = time;
    renderer.render(scene, camera);
  }
  </script>
</body>
</html>
